---
---

```{r setup, include = FALSE}
source(here::here("R", "document_setup.R"))

htmltools::tagList(rmarkdown::html_dependency_font_awesome())
```

```{r functions}
source(here("R", "load.R"))
source(here("R", "html.R"))
```

```{r load}
dataset_files <- fs::dir_ls(here("data", "datasets"), glob = "*.csv")

datasets <- get_datasets(dataset_files)
```

```{r}
tags <- htmltools::tags

tags$div(
    class = "row",
    tags$div(
        class = "col-md-4",
        value_box(nrow(datasets), caption = "Datasets", colour = "success",
                  icon = "database")
    ),
    tags$div(
        class = "col-md-4",
        value_box(length(unique(datasets$organ)), caption = "Organs",
                         colour = "info", icon = "user")
    ),
    tags$div(
        class = "col-md-4",
        value_box(scales::number(sum(datasets$ncells), big.mark = ","),
                  caption = "Cells", colour = "warning", icon = "splotch")
    )
)
```


Table
-----

```{r table}
tbl <- datasets %>%
    reactable::reactable(
        defaultSorted       = "id",
        defaultSortOrder    = "asc",
        defaultColDef       = reactable::colDef(
            class       = "cell",
            headerClass = "header",
            headerStyle = list(fontWeight = 700)
        ),
        defaultColGroup = reactable::colGroup(headerClass = "group-header"),
        compact             = TRUE,
        highlight           = TRUE,
        showSortIcon        = FALSE,
        borderless          = TRUE,
        striped             = TRUE,
        showPageSizeOptions = TRUE,
        class               = "custom-table",
        columns = list(
            id = reactable::colDef(name = "ID"),
            animal = reactable::colDef(
                name       = "Animal",
                filterable = TRUE
            ),
            organ = reactable::colDef(
                name       = "Organ",
                filterable = TRUE
            ),
            subtissue = reactable::colDef(
                name       = "Sub-tissue",
                filterable = TRUE
            ),
            ncells = reactable::colDef(name  = "Cells"),
            protocol = reactable::colDef(
                name       = "Protocol",
                filterable = TRUE
            ),
            counts = reactable::colDef(name = "Counts"),
            has_celltypes = reactable::colDef(
                name       = "Has cell types?",
                filterable = TRUE
            ),
            lab = reactable::colDef(name = "Lab"),
            year = reactable::colDef(name = "Year")
        )
    )

htmltools::div(class = "custom-table-container", tbl)
```

